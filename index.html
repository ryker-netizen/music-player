<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∏–∫—Å–µ–ª—å–Ω—ã–π –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container {
            text-align: center;
            max-width: 400px;
        }

        h1 {
            color: #00ff88;
            text-shadow: 3px 3px 0 #000;
            font-family: 'Press Start 2P', cursive;
            margin-bottom: 30px;
            font-size: 20px;
        }

        .pixel-player {
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            border: 6px solid #000;
            background: linear-gradient(45deg, #4a4a4a 0%, #6b6b6b 100%);
            padding: 25px;
            width: 320px;
            margin: 0 auto;
            box-shadow: 10px 10px 0 rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .pixel-player::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            height: 5px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        .pixel-display {
            background: #000;
            border: 3px solid #333;
            padding: 10px;
            margin-bottom: 20px;
            min-height: 100px;
            position: relative;
            overflow: hidden;
        }

        canvas {
            display: block;
            background: #000;
            width: 100%;
            height: 120px;
        }

        .track-info {
            color: #00ff88;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            margin-top: 10px;
            text-shadow: 2px 2px 0 #000;
            height: 30px;
            overflow: hidden;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .pixel-btn {
            background: #a0a0a0;
            border: 3px solid #000;
            padding: 12px 20px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            font-size: 12px;
            color: #000;
            min-width: 70px;
            transition: all 0.1s;
            position: relative;
            text-transform: uppercase;
        }

        .pixel-btn:hover {
            background: #b0b0b0;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 #000;
        }

        .pixel-btn:active {
            transform: translate(2px, 2px);
            box-shadow: none;
        }

        .pixel-btn.play {
            background: #4CAF50;
        }

        .pixel-btn.stop {
            background: #f44336;
        }

        .pixel-btn.upload {
            background: #2196F3;
        }

        .volume-control {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .volume-label {
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
        }

        input[type="range"] {
            width: 150px;
            height: 8px;
            -webkit-appearance: none;
            background: #333;
            border: 2px solid #000;
            border-radius: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: #00ff88;
            border: 2px solid #000;
            cursor: pointer;
        }

        .status {
            margin-top: 15px;
            color: #ffcc00;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            min-height: 15px;
        }

        .instructions {
            color: #aaa;
            font-size: 12px;
            margin-top: 30px;
            font-family: 'Press Start 2P', cursive;
            line-height: 1.6;
        }

        @media (max-width: 400px) {
            .pixel-player {
                width: 280px;
                padding: 15px;
            }
            
            .controls {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ü–ò–ö–°–ï–õ–¨–ù–´–ô –ü–õ–ï–ï–†</h1>
        
        <div class="pixel-player">
            <div class="pixel-display">
                <canvas id="pixelViz" width="300" height="120"></canvas>
                <div class="track-info" id="trackInfo">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª</div>
            </div>
            
            <div class="volume-control">
                <span class="volume-label">–ì–†–û–ú–ö–û–°–¢–¨:</span>
                <input type="range" id="volume" min="0" max="100" value="70">
            </div>
            
            <div class="controls">
                <button class="pixel-btn upload" onclick="uploadAudio()">üìÅ –ó–ê–ì–†–£–ó–ò–¢–¨</button>
                <button class="pixel-btn play" onclick="playPause()">‚ñ∂ –í–û–°–ü–†–û–ò–ó–í–ï–°–¢–ò</button>
                <button class="pixel-btn stop" onclick="stop()">‚èπ –û–°–¢–ê–ù–û–í–ò–¢–¨</button>
            </div>
            
            <div class="status" id="status">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</div>
        </div>
        
        <div class="instructions">
            [1] –ó–∞–≥—Ä—É–∑–∏—Ç–µ MP3 —Ñ–∞–π–ª<br>
            [2] –ù–∞–∂–º–∏—Ç–µ –í–û–°–ü–†–û–ò–ó–í–ï–°–¢–ò<br>
            [3] –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π!
        </div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const canvas = document.getElementById('pixelViz');
        const ctx = canvas.getContext('2d');
        const trackInfo = document.getElementById('trackInfo');
        const statusEl = document.getElementById('status');
        const volumeControl = document.getElementById('volume');

        // –ê—É–¥–∏–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let audioContext;
        let audioElement;
        let analyser;
        let source;
        let isPlaying = false;
        let currentFileName = '';
        let animationId;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
        function initAudio() {
            if (!audioElement) {
                audioElement = new Audio();
                audioElement.crossOrigin = "anonymous";
                
                audioElement.addEventListener('ended', () => {
                    isPlaying = false;
                    statusEl.textContent = '–í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–ï –ó–ê–í–ï–†–®–ï–ù–û';
                    cancelAnimationFrame(animationId);
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
        function uploadAudio() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'audio/*';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                currentFileName = file.name;
                const url = URL.createObjectURL(file);
                
                if (audioElement) {
                    audioElement.pause();
                    isPlaying = false;
                }
                
                initAudio();
                audioElement.src = url;
                
                trackInfo.textContent = file.name.slice(0, 20) + (file.name.length > 20 ? '...' : '');
                statusEl.textContent = '–§–ê–ô–õ –ó–ê–ì–†–£–ñ–ï–ù';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
                drawIdleScreen();
            };
            
            input.click();
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ/–ø–∞—É–∑–∞
        function playPause() {
            if (!audioElement || !audioElement.src) {
                statusEl.textContent = '–°–ù–ê–ß–ê–õ–ê –ó–ê–ì–†–£–ó–ò–¢–ï –ê–£–î–ò–û–§–ê–ô–õ';
                return;
            }
            
            if (!isPlaying) {
                playAudio();
            } else {
                pauseAudio();
            }
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
        function playAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                source = audioContext.createMediaElementSource(audioElement);
                
                source.connect(analyser);
                analyser.connect(audioContext.destination);
                
                analyser.fftSize = 256;
            }
            
            audioElement.play();
            isPlaying = true;
            statusEl.textContent = '–ò–ì–†–ê–ï–¢...';
            updateVolume();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            visualize();
        }

        // –ü–∞—É–∑–∞
        function pauseAudio() {
            audioElement.pause();
            isPlaying = false;
            statusEl.textContent = '–ù–ê –ü–ê–£–ó–ï';
            cancelAnimationFrame(animationId);
            drawPausedScreen();
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞
        function stop() {
            if (audioElement) {
                audioElement.pause();
                audioElement.currentTime = 0;
                isPlaying = false;
                statusEl.textContent = '–û–°–¢–ê–ù–û–í–õ–ï–ù–û';
            }
            
            cancelAnimationFrame(animationId);
            drawIdleScreen();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
        function updateVolume() {
            if (audioElement) {
                const volume = volumeControl.value / 100;
                audioElement.volume = volume;
            }
        }

        // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
        function visualize() {
            if (!isPlaying) return;
            
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);
            
            // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –ø–∏–∫—Å–µ–ª—å–Ω—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
            const barWidth = 4;
            const spacing = 2;
            let x = 0;
            
            // –†–∞–∑–¥–µ–ª—è–µ–º —á–∞—Å—Ç–æ—Ç—ã –Ω–∞ –≥—Ä—É–ø–ø—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
            for (let i = 0; i < bufferLength; i += 2) {
                const value = dataArray[i];
                
                // –ë–∞—Å—ã (–Ω–∏–∑–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã) - –∫—Ä–∞—Å–Ω—ã–µ
                if (i < 20) {
                    ctx.fillStyle = `rgb(${100 + value}, 50, 50)`;
                } 
                // –°—Ä–µ–¥–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã - –∑–µ–ª–µ–Ω—ã–µ
                else if (i < 60) {
                    ctx.fillStyle = `rgb(50, ${100 + value}, 50)`;
                }
                // –í—ã—Å–æ–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã - —Å–∏–Ω–∏–µ
                else {
                    ctx.fillStyle = `rgb(50, 50, ${100 + value})`;
                }
                
                // –†–∏—Å—É–µ–º —Å—Ç–æ–ª–±–∏–∫
                const barHeight = value / 2;
                ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–∏–∫—Å–µ–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.fillRect(x, canvas.height - barHeight, 1, 1);
                
                x += barWidth + spacing;
                
                if (x >= canvas.width) break;
            }
            
            // –†–∏—Å—É–µ–º –≤–æ–ª–Ω—É —Å–≤–µ—Ä—Ö—É
            ctx.beginPath();
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            
            analyser.getByteTimeDomainData(dataArray);
            
            const sliceWidth = canvas.width / bufferLength;
            let waveX = 0;
            
            for (let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * canvas.height / 3;
                
                if (i === 0) {
                    ctx.moveTo(waveX, y);
                } else {
                    ctx.lineTo(waveX, y);
                }
                
                waveX += sliceWidth;
            }
            
            ctx.stroke();
            
            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
            ctx.strokeStyle = 'rgba(0, 255, 136, 0.2)';
            ctx.lineWidth = 1;
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let i = 0; i < canvas.width; i += 20) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let i = 0; i < canvas.height; i += 20) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            animationId = requestAnimationFrame(visualize);
        }

        // –≠–∫—Ä–∞–Ω –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è
        function drawIdleScreen() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
            ctx.strokeStyle = 'rgba(0, 255, 136, 0.1)';
            ctx.lineWidth = 1;
            
            for (let i = 0; i < canvas.width; i += 20) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            
            for (let i = 0; i < canvas.height; i += 20) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
            
            // –¢–µ–∫—Å—Ç
            ctx.fillStyle = '#00ff88';
            ctx.font = '12px "Press Start 2P"';
            ctx.textAlign = 'center';
            ctx.fillText('–ó–ê–ì–†–£–ó–ò–¢–ï', canvas.width/2, canvas.height/2 - 10);
            ctx.fillText('–ê–£–î–ò–û–§–ê–ô–õ', canvas.width/2, canvas.height/2 + 10);
        }

        // –≠–∫—Ä–∞–Ω –Ω–∞ –ø–∞—É–∑–µ
        function drawPausedScreen() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ú–∏–≥–∞—é—â–∏–π —Ç–µ–∫—Å—Ç
            const blink = Math.floor(Date.now() / 500) % 2 === 0;
            
            if (blink) {
                ctx.fillStyle = '#ffcc00';
                ctx.font = '14px "Press Start 2P"';
                ctx.textAlign = 'center';
                ctx.fillText('–ü–ê–£–ó–ê', canvas.width/2, canvas.height/2);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            initAudio();
            drawIdleScreen();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
            volumeControl.addEventListener('input', updateVolume);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–æ–º–∫–æ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            updateVolume();
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ (–¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏)
        window.addEventListener('resize', function() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∫–∞–Ω–≤–∞—Å–∞
            canvas.width = 300;
            canvas.height = 120;
            
            if (!isPlaying) {
                if (audioElement && audioElement.paused) {
                    drawPausedScreen();
                } else {
                    drawIdleScreen();
                }
            }
        });
    </script>
</body>
</html>
